<script type="text/javascript">
	RED.nodes.registerType('semaphore-plus-take', {
		category: 'Semaphore Plus',
		color: 'rgb(46,145,205)',
		defaults: {
			name: { value: 'Semaphore Take' },
			timeout: { value: 0 },
			config: { value: '', type: 'semaphore-plus-config' },
			avoidance: { value: 'never' },
			threshold: { value: 5 },
			msgPart: { value: 'smp_avoidQueue' },
			partType: { value: 'msg' }
		},
		inputs: 1,
		outputs: 2,
		outputLabels: ['Queued Message', 'Queue Avoidance'],
		icon: 'font-awesome/fa-lock',
		label: function () {
			return this.name;
		},
		paletteLabel: 'Semaphore Take',
		oneditprepare: Prep
	});

	function Prep() {
		$('#node-input-msgPart').typedInput({
			types: ['msg', 'jsonata'],
			default: 'msg',
			typeField: '#node-input-partType'
		});
	}
</script>

<!-- prettier-ignore -->
<script type="text/x-red" data-template-name="semaphore-plus-take">

	<input type="hidden" id="node-input-partType">

	<div class="form-row">
	      <label for="node-input-name" style="width:130px"><i class="fa fa-pencil"></i> Name</label>
	      <input type="text" id="node-input-name" placeholder="Name" />
	</div>

	<div class="form-row">
	     <label for="node-input-config" style="width:130px"><i class="fa fa-pencil"></i> Config</label>
	     <select id="node-input-config"></select>
	</div>

	<div class="form-row">
	    <label for="node-input-timeout" style="width:130px"><i class="fa fa-pencil"></i> Fail-safe (ms)</label>
	    <input type="number" id="node-input-timeout" />
	</div>

	<div class="form-tips">
		Queue Avoidance settings only applies when the lock is in use. Messages avoiding the queue, will be output to Pin 2.
	</div>

	<br />

	<div class="form-row">
		<label for="node-input-avoidance" style="width:130px"><i class="fa fa-pencil"></i> Avoidance Mode</label>
		<select id="node-input-avoidance" style="width:70%">
			<option value="never">Never</option>
			<option value="msg">Per msg (must evaluate to true:false)</option>
			<option value="threshold">GQ Threshold</option>
		</select>
	</div>

	<div class="form-row">
		<label for="node-input-msgPart" style="width:130px"><i class="fa fa-pencil"></i> MSG Part</label>
		<input type="text" id="node-input-msgPart" placeholder="Name" />
	</div>

	<div class="form-row">
		<label for="node-input-threshold" style="width:130px"><i class="fa fa-pencil"></i> Threshold</label>
		<input type="number" id="node-input-threshold" />
	</div>
</script>

<!-- prettier-ignore -->
<script type="text/markdown" data-help-name="semaphore-plus-take">
<p>Semaphore Take Node</p>
</script>
